

# Multi-Feature Update Plan

## 1. Fix Search to Match by Name (not UUID)

The `CommandItem` currently has `value={i.id}` (a UUID), so typing a mock test name won't match anything. The fix is to set `value` to a string that includes the mock test's display name plus its unique ID, so cmdk can filter by name while keeping items unique.

**File**: `src/components/layout/DashboardLayout.tsx`

## 2. Download Real PDF Instead of TXT

The current edge function generates a plain text file. It will be rewritten to use the `pdf-lib` library (works natively in Deno) to generate a proper PDF with:
- Logo embedded at the top (fetched from the published app URL as a PNG)
- All scores, grammar mistakes, red flags, improvement plan, AI summary, and transcript
- Footer: "Generated by Visa Cracked" (no URL)
- File extension changed to `.pdf`

The client-side download code will also be updated to use `application/pdf` as the blob type.

**Files**: `supabase/functions/generate-report-pdf/index.ts`, `src/pages/InterviewReport.tsx`

## 3. Remove Emoji from "Better Answer"

Change `ðŸ’¡ Better Answer` to just `Better Answer` in the detailed feedback section.

**File**: `src/pages/InterviewReport.tsx`

## 4. Redesign Pricing Modal

Redesign based on the reference image with:
- Plan name + subtitle (e.g., "For your mock preparation")
- Large price with "/pack" suffix
- "Best Value" badge on Pro, "Popular" badge on Premium
- Cleaner spacing, rounded cards with subtle borders
- CTA buttons: outline for Starter/Premium, filled accent for Pro

**File**: `src/components/pricing/PricingModal.tsx`

## 5. Report Access - Already Secured

The `/interview/:id/report` route is behind `RequireAuth`, and the database RLS policies already enforce that users can only view their own interviews (`auth.uid() = user_id`) while admins can view all. No code changes needed -- this is already working correctly. Public sharing only works via `/mock/:id/public` with the `is_public` flag.

## 6. Resend API for Auth Emails

Lovable Cloud does not currently support configuring custom SMTP providers for authentication emails through the available tools. This would require direct backend configuration access that isn't available. I'll note this limitation in the implementation -- the auth emails will continue to come from the default sender.

---

## Technical Details

### Search Fix
```tsx
<CommandItem
  key={i.id}
  value={`${i.name || `${i.countries?.name} ${i.visa_types?.name}`} ${i.id}`}
  onSelect={() => { ... }}
>
```

### PDF Generation (Edge Function)
- Import `pdf-lib` from esm.sh: `import { PDFDocument, StandardFonts, rgb } from "https://esm.sh/pdf-lib@1.17.1"`
- Embed logo PNG at top of first page
- Render sections: header info, scores table, grammar, red flags, improvement plan, summary, transcript
- Handle page breaks automatically
- Footer on each page: "Generated by Visa Cracked"
- Return base64-encoded PDF with `.pdf` filename

### Client-Side Download Update
```tsx
const blob = new Blob([Uint8Array.from(atob(data.pdf), (c) => c.charCodeAt(0))], { type: "application/pdf" });
```

### Pricing Modal Redesign
Three cards side by side:
- Starter: "For beginners", 800 TK /pack, outline button
- Pro: "Best Value" badge, "For serious prep", 1,500 TK /pack, filled accent button
- Premium: "Popular" badge, "Maximum preparation", 2,800 TK /pack, outline button
- Each card lists features with green checkmarks
- Cleaner, more spacious layout matching reference

### Files to Modify

| File | Change |
|------|--------|
| `src/components/layout/DashboardLayout.tsx` | Fix CommandItem value to include name for search |
| `supabase/functions/generate-report-pdf/index.ts` | Rewrite to generate real PDF with pdf-lib + logo |
| `src/pages/InterviewReport.tsx` | Update download blob type to PDF; remove emoji from "Better Answer" |
| `src/components/pricing/PricingModal.tsx` | Redesign with reference UI layout |

